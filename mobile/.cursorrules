# Cursor Rules - Tennis Management Mobile App

## üìã Reglas Generales

### Arquitectura
- **Clean Architecture**: Separaci√≥n clara de capas (domain, presentation, data)
- **Organizaci√≥n por features**: Cada feature tiene su propia carpeta con domain, presentation, data
- **Riverpod para state management**: Usar providers para gesti√≥n de estado
- **Separaci√≥n de responsabilidades**: Servicios para l√≥gica de negocio, providers para orquestaci√≥n

### Est√°ndares de C√≥digo
- **Sin `print` statements**: Usar `AppLogger` para logging estructurado
- **Sin comentarios innecesarios**: El c√≥digo debe ser autoexplicativo
- **Imports no usados**: Eliminar siempre
- **Documentaci√≥n**: Agregar `///` a m√©todos p√∫blicos

---

## üö® REGLAS CR√çTICAS - Manejo de Errores

### 1. Jerarqu√≠a de Excepciones OBLIGATORIA

**NUNCA usar `Exception` gen√©rico. SIEMPRE usar excepciones espec√≠ficas:**

```dart
// ‚ùå PROHIBIDO
throw Exception('Error al obtener datos');

// ‚úÖ CORRECTO
throw NetworkException.serverError(
  message: 'Error al obtener datos',
  statusCode: response.statusCode,
);
```

**Excepciones disponibles:**
- `AppException` (base abstracta - no instanciar directamente)
- `NetworkException` - Para errores de red, timeout, conexi√≥n
- `AuthException` - Para errores de autenticaci√≥n
- `ValidationException` - Para errores de validaci√≥n de datos
- `DomainException` - Para errores de l√≥gica de negocio
  - `ScheduleException` - Para errores de horarios
  - `TenantException` - Para errores de centros

**Ubicaci√≥n:** `lib/core/exceptions/`

### 2. Mensajes de Error Centralizados OBLIGATORIO

**NUNCA hardcodear mensajes de error. SIEMPRE usar `ErrorMessages`:**

```dart
// ‚ùå PROHIBIDO
throw AuthException('Usuario no autenticado');

// ‚úÖ CORRECTO
throw AuthException.notAuthenticated(); // Usa ErrorMessages internamente

// O si necesitas mensaje personalizado:
throw AuthException(
  ErrorMessages.notAuthenticated,
  code: 'NOT_AUTHENTICATED',
);
```

**Ubicaci√≥n:** `lib/core/constants/error_messages.dart`

### 3. Logging Estructurado OBLIGATORIO

**NUNCA usar `print()`. SIEMPRE usar `AppLogger`:**

```dart
// ‚ùå PROHIBIDO
print('Error: $e');
print('Usuario: $user');

// ‚úÖ CORRECTO
final _logger = AppLogger.tag('MyService');
_logger.info('Operaci√≥n iniciada');
_logger.debug('Detalles', {'userId': user.id});
_logger.error('Error en operaci√≥n', error: e, stackTrace: stackTrace);
```

**O usando la extensi√≥n:**
```dart
class MyService {
  Future<void> doSomething() async {
    logger.info('Iniciando'); // logger es autom√°tico
  }
}
```

**Niveles disponibles:**
- `debug()` - Solo desarrollo, informaci√≥n detallada
- `info()` - Informaci√≥n general
- `warning()` - Advertencias
- `error()` - Errores con contexto
- `fatal()` - Errores cr√≠ticos (siempre se muestran)

**Ubicaci√≥n:** `lib/core/logging/logger.dart`

### 4. Timeouts Centralizados OBLIGATORIO

**NUNCA hardcodear timeouts. SIEMPRE usar `Timeouts`:**

```dart
// ‚ùå PROHIBIDO
.timeout(const Duration(seconds: 10))
await Future.delayed(const Duration(seconds: 2));

// ‚úÖ CORRECTO
.timeout(Timeouts.httpRequest)
await Future.delayed(Timeouts.snackbarSuccess);
```

**Constantes disponibles:**
- `Timeouts.httpRequest` - Requests HTTP est√°ndar (10s)
- `Timeouts.httpRequestLong` - Requests largos (30s)
- `Timeouts.httpRequestShort` - Requests cortos (5s)
- `Timeouts.snackbarSuccess` - Mensajes de √©xito (2s)
- `Timeouts.snackbarError` - Mensajes de error (3s)
- `Timeouts.animationShort/Medium/Long` - Animaciones
- Y m√°s... ver `lib/core/constants/timeouts.dart`

**Ubicaci√≥n:** `lib/core/constants/timeouts.dart`

### 5. Result<T> Pattern (Opcional pero Recomendado)

**Para errores esperados, considerar usar `Result<T>`:**

```dart
// ‚úÖ BUENO: Para validaciones, b√∫squedas opcionales
Future<Result<FormData>> validateForm(Map<String, dynamic> data) async {
  // Validaci√≥n...
  if (errors.isNotEmpty) {
    return Result.failure(ValidationException(...));
  }
  return Result.success(FormData.fromMap(data));
}
```

**Cu√°ndo usar:**
- ‚úÖ Validaci√≥n de formularios
- ‚úÖ B√∫squedas que pueden no encontrar resultados
- ‚úÖ Operaciones que fallan frecuentemente

**Cu√°ndo NO usar:**
- ‚ùå Errores realmente excepcionales (usar excepciones)
- ‚ùå Errores de programaci√≥n (usar excepciones)

**Ubicaci√≥n:** `lib/core/result/result.dart`

---

## üìù Estructura de Servicios

### Servicios de Dominio
- Deben estar en `lib/features/{feature}/domain/services/`
- Deben usar `AppLogger` para logging
- Deben usar excepciones espec√≠ficas de la jerarqu√≠a
- Deben usar `Timeouts` para timeouts
- Deben usar `ErrorMessages` para mensajes

**Ejemplo:**
```dart
class MyService {
  final _logger = AppLogger.tag('MyService');
  
  Future<Data> getData() async {
    _logger.debug('Obteniendo datos');
    try {
      // ... c√≥digo
      _logger.info('Datos obtenidos exitosamente');
      return data;
    } on AppException catch (e, stackTrace) {
      _logger.error('Error al obtener datos', 
        error: e, 
        stackTrace: stackTrace,
      );
      rethrow;
    }
  }
}
```

---

## üéØ Imports Est√°ndar

### Para Excepciones
```dart
import '../../../../core/exceptions/exceptions.dart';
```

### Para Logging
```dart
import '../../../../core/logging/logger.dart';
```

### Para Constantes
```dart
import '../../../../core/constants/error_messages.dart';
import '../../../../core/constants/timeouts.dart';
```

### Para Result
```dart
import '../../../../core/result/result.dart';
```

---

## ‚úÖ Checklist para Nuevo C√≥digo

Antes de crear un nuevo servicio o modificar uno existente:

- [ ] ¬øUsa excepciones espec√≠ficas de la jerarqu√≠a? (NO `Exception` gen√©rico)
- [ ] ¬øUsa `ErrorMessages` para mensajes? (NO strings hardcodeados)
- [ ] ¬øUsa `AppLogger` para logging? (NO `print`)
- [ ] ¬øUsa `Timeouts` para timeouts? (NO `Duration` hardcodeado)
- [ ] ¬øTiene documentaci√≥n `///` en m√©todos p√∫blicos?
- [ ] ¬øManeja errores apropiadamente con try/catch?

---

## üö´ Prohibiciones Absolutas

1. **NUNCA** usar `throw Exception('mensaje')`
2. **NUNCA** usar `print()` para logging
3. **NUNCA** hardcodear mensajes de error
4. **NUNCA** hardcodear timeouts con `Duration(seconds: X)`
5. **NUNCA** usar `dynamic` cuando se puede usar un tipo espec√≠fico
6. **NUNCA** mezclar l√≥gica HTTP en providers (debe estar en servicios)

---

## üìö Referencias

- Excepciones: `lib/core/exceptions/`
- Constantes: `lib/core/constants/`
- Logging: `lib/core/logging/`
- Result: `lib/core/result/`
- Documentaci√≥n: `lib/core/README.md`

---

**Estas reglas son OBLIGATORIAS y deben seguirse en TODO el c√≥digo nuevo y refactorizado.**

