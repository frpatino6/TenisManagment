# Cursor Rules - Tennis Management Backend

## üìã Reglas Generales

### Arquitectura
- **Clean Architecture**: Mantener separaci√≥n clara de responsabilidades.
  - `src/application/controllers`: Manejo de peticiones HTTP (Express).
  - `src/domain/services` / `src/application/services`: L√≥gica de negocio pura.
  - `src/infrastructure`: Implementaciones t√©cnicas (DB, Auth, Logger).
- **Inyecci√≥n de Dependencias**: Favorecer la inyecci√≥n de dependencias para facilitar el testing.
- **Stateless**: Los servicios deben ser stateless.

### Est√°ndares de C√≥digo
- **TypeScript Estricto**: Evitar `any` a toda costa. Definir interfaces para DTOs.
- **Sin `console.log`**: Usar estrictamente `Logger` (`infrastructure/services/Logger`).
- **Sin comentarios innecesarios**: El c√≥digo debe ser autoexplicativo (Regla de Oro).
- **Async/Await**: Preferir `async/await` sobre `.then()`.
- **Promesas Flotantes**: Cumplir regla `@typescript-eslint/no-floating-promises`. Usar `await`, `.catch()` o `void` expl√≠cito.
- **Validaci√≥n**: Usar `Zod` para validar entradas en los controladores.
- **Inmutabilidad**: Preferir `const` sobre `let`. Evitar mutar objetos directamente siempre que sea posible.
- **Guard Clauses**: Usar retornos tempranos (early returns) para evitar anidamiento profundo y mejorar la legibilidad.

### Convenciones de Nombres
- **Clases y Archivos**: `PascalCase` (ej. `AuthService.ts`, `UserController`).
- **M√©todos y Variables**: `camelCase` (ej. `verifyToken`, `userData`).
- **Constantes**: `UPPER_SNAKE_CASE` (ej. `MAX_LOGIN_ATTEMPTS`).

### Seguridad
- **Secretos**: Prohibido hardcodear credenciales, tokens o claves. Usar variables de entorno.
- **Sanitizaci√≥n**: Confiar en la validaci√≥n de esquemas (`Zod`) para prevenir inyecciones.

---

## üìù Est√°ndar de Comentarios (TSDoc)

**OBLIGATORIO: Documentaci√≥n profesional usando TSDoc (`/** ... */`)**

Se debe aplicar el mejor est√°ndar de comentarios en:
1. **Clases Exportadas**: Explicar responsabilidad.
2. **M√©todos P√∫blicos**: Explicar qu√© hace, par√°metros, retornos y excepciones.

**Ejemplo:**
```typescript
/**
 * Procesa el pago de una reserva.
 * 
 * @param bookingId - ID de la reserva a pagar.
 * @param amount - Monto del pago.
 * @returns El objeto de pago procesado.
 * @throws {PaymentError} Si la pasarela rechaza la transacci√≥n.
 */
public async processPayment(bookingId: string, amount: number): Promise<Payment> { ... }
```

---

## üö® REGLAS CR√çTICAS - Calidad y Testing

### 1. NO CODE WITHOUT TESTS (Sin Tests No Hay C√≥digo)
**Regla Inquebrantable**: No se debe entregar ning√∫n cambio (feature, fix o refactor) sin su respectivo test.

- **Unit Tests**: Obligatorios para Servicios y L√≥gica de Negocio.
- **Integration Tests**: Obligatorios para nuevos Endpoints/Controladores.
- **Bug Fixes**: Deben incluir un test que falle antes del fix y pase despu√©s (Regression Testing).

### 2. Manejo de Errores
- **HTTP Codes**: Usar c√≥digos sem√°nticos (200, 201, 400, 401, 403, 404, 500).
- **Try/Catch**: Los controladores deben capturar errores y usar el Logger.
- **Excepciones**: No tragar errores silenciosamente.

### 3. Logging Estructurado (Com√∫n con Mobile)
Al igual que en mobile, el logging debe ser estructurado para facilitar la depuraci√≥n en producci√≥n.

```typescript
// ‚ùå PROHIBIDO
console.log('Error', error);

// ‚úÖ CORRECTO
this.logger.error('Error procesando pago', { 
  error: error.message, 
  stack: error.stack,
  bookingId 
});
```

---

## ‚úÖ Checklist de Entrega

Antes de considerar una tarea completada:

- [ ] ¬øEl c√≥digo cumple con las reglas de linter (sin promesas flotantes)?
- [ ] ¬øSe han eliminado todos los `console.log`?
- [ ] ¬øEst√° documentado con TSDoc?
- [ ] **¬øTiene tests que validen el cambio?**
- [ ] ¬øSe manejan los errores adecuadamente?
- [ ] ¬øSe respetan las convenciones de nombres y estructura?

---

## üö´ Prohibiciones

1. **NUNCA** dejar `console.log` en el c√≥digo.
2. **NUNCA** usar `any` si se puede tipar.
3. **NUNCA** ignorar errores en un `catch` vac√≠o.
4. **NUNCA** subir c√≥digo sin tests.
5. **NUNCA** exponer secretos o credenciales en el c√≥digo.